---
import Base from "@/layouts/Base.astro";
import ImageMod from "@/components/ImageMod.astro";
import DynamicIcon from "@/helpers/DynamicIcon";
import config from "@/config/config.json";
import GrainientBg from "@/components/GrainientBg";

const links = [
  {
    name: "GitHub",
    description: "Open source projects & contributions",
    icon: "FaGithub",
    url: "https://github.com/Ying-Kai-Liao",
    span: "large",
  },
  {
    name: "LinkedIn",
    description: "Professional network",
    icon: "FaLinkedin",
    url: "https://www.linkedin.com/in/ying-kai-liao",
    span: "small",
  },
  {
    name: "X / Twitter",
    description: "Thoughts & updates",
    icon: "FaXTwitter",
    url: "https://x.com/YingKaiLiao1",
    span: "small",
  },
  {
    name: "Threads",
    description: "Casual posts",
    icon: "FaThreads",
    url: "https://www.threads.com/@yinn__nkai",
    span: "small",
  },
  {
    name: "Instagram",
    description: "Photos & stories",
    icon: "FaInstagram",
    url: "https://www.instagram.com/yinn__nkai",
    span: "small",
  },
  {
    name: "Blog",
    description: "AI, dev, data science & startup lessons",
    icon: "FaPenNib",
    url: "/blog",
    span: "large",
    internal: true,
  },
];
---

<Base title="Links" meta_title="Links â€” Kai Liao" description="All my links in one place.">
  <section class="section pt-14 relative overflow-hidden">
    <!-- Grainient background -->
    <div class="absolute inset-0 -z-10">
      <GrainientBg
        client:load
        timeSpeed={0.15}
        grainAmount={0.12}
        grainScale={2.0}
        grainAnimated={true}
        contrast={1.2}
        saturation={0.4}
        warpStrength={1.0}
        warpFrequency={3.0}
        warpSpeed={1.0}
        warpAmplitude={60.0}
        rotationAmount={300.0}
        className="w-full h-full"
      />
    </div>
    <!-- QR button top right -->
    <button
      id="qr-toggle"
      class="absolute top-4 right-4 z-10 inline-flex items-center justify-center w-10 h-10 rounded-xl bg-white/80 dark:bg-darkmode-light/80 backdrop-blur-sm border border-border dark:border-darkmode-border text-text-light dark:text-darkmode-text-light hover:text-primary dark:hover:text-darkmode-primary shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer"
      aria-label="Show QR code"
      title="Share QR"
    >
      <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="2" y="2" width="8" height="8" rx="1" />
        <rect x="14" y="2" width="8" height="8" rx="1" />
        <rect x="2" y="14" width="8" height="8" rx="1" />
        <rect x="14" y="14" width="4" height="4" />
        <rect x="20" y="14" width="2" height="2" />
        <rect x="14" y="20" width="2" height="2" />
        <rect x="20" y="20" width="2" height="2" />
      </svg>
    </button>

    <div class="container max-w-2xl">
      <!-- Profile header -->
      <div class="text-center mb-10 animate-fade-in-up">
        <button
          id="profile-toggle"
          class="relative w-20 h-20 mx-auto mb-4 rounded-full cursor-pointer focus:outline-none group"
          style="perspective: 600px;"
          aria-label="Toggle profile picture"
        >
          <div id="profile-flipper" class="relative w-full h-full transition-transform duration-500" style="transform-style: preserve-3d;">
            <!-- Icon (front) -->
            <div class="absolute inset-0" style="backface-visibility: hidden;">
              <ImageMod
                src="/images/profile/avatar-yk.png"
                height={96}
                width={96}
                alt="Kai Liao avatar"
                class="rounded-full object-cover w-20 h-20 shadow-md ring-4 ring-light dark:ring-darkmode-light group-hover:ring-primary/30 dark:group-hover:ring-darkmode-primary/30 transition-all duration-200"
                format="webp"
              />
            </div>
            <!-- Real photo (back) -->
            <div class="absolute inset-0" style="backface-visibility: hidden; transform: rotateY(180deg);">
              <img
                src="/images/profile/yk-2025.jpg"
                alt="Kai Liao photo"
                class="rounded-full object-cover w-20 h-20 shadow-md ring-4 ring-light dark:ring-darkmode-light group-hover:ring-primary/30 dark:group-hover:ring-darkmode-primary/30 transition-all duration-200"
                fetchpriority="high"
              />
            </div>
          </div>
        </button>
        <h1 class="text-h3 mb-1">Kai Liao</h1>
        <p class="text-text-light dark:text-darkmode-text-light mb-4">Developer & Startup Builder</p>
        <!-- QR Code toggle -->
      </div>

      <!-- QR modal overlay -->
      <div id="qr-overlay" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div id="qr-backdrop" class="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>
        <div class="relative bg-white dark:bg-darkmode-body p-6 rounded-2xl shadow-xl text-center animate-fade-in-up">
          <img
            id="qr-img"
            alt="QR code for this page"
            class="w-48 h-48"
          />
        </div>
      </div>

      <!-- Preload real photo -->
      <link rel="preload" href="/images/profile/yk-2025.jpg" as="image" />

      <script>
        document.addEventListener('astro:page-load', () => {
          const toggle = document.getElementById('profile-toggle');
          const flipper = document.getElementById('profile-flipper');
          if (!toggle || !flipper) return;

          let flipped = false;
          const flip = () => {
            flipped = !flipped;
            flipper.style.transform = flipped ? 'rotateY(180deg)' : 'rotateY(0deg)';
          };

          // Click to flip manually (resets timer)
          toggle.addEventListener('click', () => {
            flip();
            clearInterval(timer);
            timer = setInterval(flip, 5000);
          });

          // Auto-flip every 5 seconds
          let timer = setInterval(flip, 5000);
        });

        // QR code toggle
        document.addEventListener('astro:page-load', () => {
          const btn = document.getElementById('qr-toggle');
          const overlay = document.getElementById('qr-overlay');
          const img = document.getElementById('qr-img') as HTMLImageElement;
          if (!btn || !overlay || !img) return;

          let visible = false;
          const url = 'https://ykliao.netlify.app/links';
          img.src = `https://api.qrserver.com/v1/create-qr-code/?size=192x192&data=${encodeURIComponent(url)}&margin=8`;

          const backdrop = document.getElementById('qr-backdrop');

          btn.addEventListener('click', () => {
            overlay.classList.remove('hidden');
          });

          backdrop?.addEventListener('click', () => {
            overlay.classList.add('hidden');
          });
        });
      </script>

      <!-- Bento grid -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 animate-fade-in-up animate-delay-100">
        {links.map((link) => (
          <a
            href={link.url}
            target={link.internal ? "_self" : "_blank"}
            rel={link.internal ? "" : "noopener noreferrer"}
            class:list={[
              "fluid-glass group relative rounded-2xl p-6 flex flex-col items-center justify-center text-center cursor-pointer overflow-hidden",
              link.span === "large" ? "col-span-2" : "col-span-1",
            ]}
          >
            <DynamicIcon
              icon={link.icon}
              className="text-3xl mb-3 text-text-dark dark:text-darkmode-text-dark group-hover:text-white transition-colors duration-300 relative z-[2]"
            />
            <span class="font-semibold text-text-dark dark:text-darkmode-text-dark group-hover:text-white text-sm relative z-[2] transition-colors duration-300">{link.name}</span>
          </a>
        ))}
      </div>
    </div>
  </section>
</Base>

<style>
  .fluid-glass {
    background: rgba(255, 255, 255, 0.25);
    backdrop-filter: blur(16px) saturate(180%);
    -webkit-backdrop-filter: blur(16px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.35);
    box-shadow:
      0 4px 24px -1px rgba(0, 0, 0, 0.06),
      inset 0 1px 0 rgba(255, 255, 255, 0.5);
    transition: transform 0.35s cubic-bezier(0.22, 1, 0.36, 1),
                box-shadow 0.35s cubic-bezier(0.22, 1, 0.36, 1),
                background 0.35s ease;
  }

  :global(.dark) .fluid-glass {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.12);
    box-shadow:
      0 4px 24px -1px rgba(0, 0, 0, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.08);
  }

  /* Prismatic refraction sheen */
  .fluid-glass::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0) 0%,
      rgba(255, 255, 255, 0.4) 40%,
      rgba(200, 220, 255, 0.2) 50%,
      rgba(255, 255, 255, 0) 60%
    );
    background-size: 250% 250%;
    background-position: 100% 100%;
    transition: background-position 0.6s cubic-bezier(0.22, 1, 0.36, 1);
    z-index: 1;
    pointer-events: none;
  }

  .fluid-glass:hover::before {
    background-position: 0% 0%;
  }

  /* Chromatic edge glow on hover */
  .fluid-glass::after {
    content: '';
    position: absolute;
    inset: -1px;
    border-radius: inherit;
    background: conic-gradient(
      from 0deg,
      rgba(74, 158, 111, 0.5),
      rgba(57, 255, 20, 0.3),
      rgba(34, 197, 94, 0.4),
      rgba(74, 158, 111, 0.5)
    );
    z-index: 0;
    opacity: 0;
    transition: opacity 0.35s ease;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    padding: 1.5px;
  }

  .fluid-glass:hover::after {
    opacity: 1;
    animation: glass-border-spin 3s linear infinite;
  }

  .fluid-glass:hover {
    transform: translateY(-4px);
    background: rgba(255, 255, 255, 0.35);
    box-shadow:
      0 12px 40px -4px rgba(74, 158, 111, 0.15),
      0 4px 12px -2px rgba(0, 0, 0, 0.08),
      inset 0 1px 0 rgba(255, 255, 255, 0.6);
  }

  :global(.dark) .fluid-glass:hover {
    background: rgba(255, 255, 255, 0.14);
    box-shadow:
      0 12px 40px -4px rgba(57, 255, 20, 0.2),
      0 4px 12px -2px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.12);
  }

  @keyframes glass-border-spin {
    to { filter: hue-rotate(360deg); }
  }

  @media (prefers-reduced-motion: reduce) {
    .fluid-glass,
    .fluid-glass::before,
    .fluid-glass::after {
      transition: none;
      animation: none;
    }
  }
</style>
