---
import Base from "@/layouts/Base.astro";
import ImageMod from "@/components/ImageMod.astro";
import DynamicIcon from "@/helpers/DynamicIcon";
import config from "@/config/config.json";

const links = [
  {
    name: "GitHub",
    description: "Open source projects & contributions",
    icon: "FaGithub",
    url: "https://github.com/Ying-Kai-Liao",
    span: "large",
  },
  {
    name: "LinkedIn",
    description: "Professional network",
    icon: "FaLinkedin",
    url: "https://www.linkedin.com/in/ying-kai-liao",
    span: "small",
  },
  {
    name: "X / Twitter",
    description: "Thoughts & updates",
    icon: "FaXTwitter",
    url: "https://x.com/YingKaiLiao1",
    span: "small",
  },
  {
    name: "Threads",
    description: "Casual posts",
    icon: "FaThreads",
    url: "https://www.threads.com/@yinn__nkai",
    span: "small",
  },
  {
    name: "Instagram",
    description: "Photos & stories",
    icon: "FaInstagram",
    url: "https://www.instagram.com/yinn__nkai",
    span: "small",
  },
  {
    name: "Blog",
    description: "AI, dev, data science & startup lessons",
    icon: "FaPenNib",
    url: "/blog",
    span: "large",
    internal: true,
  },
];
---

<Base title="Links" meta_title="Links â€” Kai Liao" description="All my links in one place.">
  <section class="section pt-14 relative overflow-hidden">
    <!-- Background image -->
    <div class="absolute inset-0 -z-10">
      <img
        src="/images/profile/sydney-lightrail.jpg"
        alt=""
        class="w-full h-full object-cover"
        fetchpriority="high"
      />
      <div class="absolute inset-0 bg-body/50 dark:bg-darkmode-body/60"></div>
    </div>
    <div class="container max-w-2xl">
      <!-- Profile header -->
      <div class="text-center mb-10 animate-fade-in-up">
        <button
          id="profile-toggle"
          class="relative w-20 h-20 mx-auto mb-4 rounded-full cursor-pointer focus:outline-none group"
          style="perspective: 600px;"
          aria-label="Toggle profile picture"
        >
          <div id="profile-flipper" class="relative w-full h-full transition-transform duration-500" style="transform-style: preserve-3d;">
            <!-- Icon (front) -->
            <div class="absolute inset-0" style="backface-visibility: hidden;">
              <ImageMod
                src="/images/profile/avatar-yk.png"
                height={96}
                width={96}
                alt="Kai Liao avatar"
                class="rounded-full object-cover w-20 h-20 shadow-md ring-4 ring-light dark:ring-darkmode-light group-hover:ring-primary/30 dark:group-hover:ring-darkmode-primary/30 transition-all duration-200"
                format="webp"
              />
            </div>
            <!-- Real photo (back) -->
            <div class="absolute inset-0" style="backface-visibility: hidden; transform: rotateY(180deg);">
              <img
                src="/images/profile/yk-2025.jpg"
                alt="Kai Liao photo"
                class="rounded-full object-cover w-20 h-20 shadow-md ring-4 ring-light dark:ring-darkmode-light group-hover:ring-primary/30 dark:group-hover:ring-darkmode-primary/30 transition-all duration-200"
                fetchpriority="high"
              />
            </div>
          </div>
        </button>
        <h1 class="text-h3 mb-1">Kai Liao</h1>
        <p class="text-text-light dark:text-darkmode-text-light mb-4">Developer & Startup Builder</p>
        <!-- QR Code toggle -->
        <button
          id="qr-toggle"
          class="inline-flex items-center gap-2 px-4 py-2 rounded-xl border border-border dark:border-darkmode-border text-sm text-text-light dark:text-darkmode-text-light hover:text-primary dark:hover:text-darkmode-primary hover:border-primary dark:hover:border-darkmode-primary transition-all duration-200 cursor-pointer"
          aria-label="Show QR code"
        >
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="2" width="8" height="8" rx="1" />
            <rect x="14" y="2" width="8" height="8" rx="1" />
            <rect x="2" y="14" width="8" height="8" rx="1" />
            <rect x="14" y="14" width="4" height="4" />
            <rect x="20" y="14" width="2" height="2" />
            <rect x="14" y="20" width="2" height="2" />
            <rect x="20" y="20" width="2" height="2" />
          </svg>
          <span id="qr-label">Share QR</span>
        </button>
        <!-- QR overlay -->
        <div id="qr-overlay" class="hidden mt-4">
          <div class="inline-block bg-white p-4 rounded-2xl shadow-lg">
            <img
              id="qr-img"
              alt="QR code for this page"
              class="w-48 h-48"
            />
          </div>
          <p class="text-xs text-text-light dark:text-darkmode-text-light mt-2">Scan to open this page</p>
        </div>
      </div>

      <!-- Preload real photo -->
      <link rel="preload" href="/images/profile/yk-2025.jpg" as="image" />

      <script>
        document.addEventListener('astro:page-load', () => {
          const toggle = document.getElementById('profile-toggle');
          const flipper = document.getElementById('profile-flipper');
          if (!toggle || !flipper) return;

          let flipped = false;
          const flip = () => {
            flipped = !flipped;
            flipper.style.transform = flipped ? 'rotateY(180deg)' : 'rotateY(0deg)';
          };

          // Click to flip manually (resets timer)
          toggle.addEventListener('click', () => {
            flip();
            clearInterval(timer);
            timer = setInterval(flip, 5000);
          });

          // Auto-flip every 5 seconds
          let timer = setInterval(flip, 5000);
        });

        // QR code toggle
        document.addEventListener('astro:page-load', () => {
          const btn = document.getElementById('qr-toggle');
          const overlay = document.getElementById('qr-overlay');
          const img = document.getElementById('qr-img') as HTMLImageElement;
          const label = document.getElementById('qr-label');
          if (!btn || !overlay || !img || !label) return;

          let visible = false;
          const url = 'https://ykliao.netlify.app/links';
          img.src = `https://api.qrserver.com/v1/create-qr-code/?size=192x192&data=${encodeURIComponent(url)}&margin=8`;

          btn.addEventListener('click', () => {
            visible = !visible;
            overlay.classList.toggle('hidden', !visible);
            label.textContent = visible ? 'Hide QR' : 'Share QR';
          });
        });
      </script>

      <!-- Bento grid -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 animate-fade-in-up animate-delay-100">
        {links.map((link) => (
          <a
            href={link.url}
            target={link.internal ? "_self" : "_blank"}
            rel={link.internal ? "" : "noopener noreferrer"}
            class:list={[
              "group rounded-2xl border border-border dark:border-darkmode-border bg-white dark:bg-darkmode-light p-6 flex flex-col items-center justify-center text-center shadow-sm transition-all duration-200 cursor-pointer hover:-translate-y-1 hover:shadow-lg",
              link.span === "large" ? "col-span-2" : "col-span-1",
            ]}
          >
            <DynamicIcon
              icon={link.icon}
              className="text-3xl mb-3 text-text-dark dark:text-darkmode-text-dark group-hover:text-primary dark:group-hover:text-darkmode-primary transition-colors duration-200"
            />
            <span class="font-semibold text-text-dark dark:text-darkmode-text-dark text-sm">{link.name}</span>
            <span class="text-xs text-text-light dark:text-darkmode-text-light mt-1">{link.description}</span>
          </a>
        ))}
      </div>
    </div>
  </section>
</Base>
